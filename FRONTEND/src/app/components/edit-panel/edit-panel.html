<div class="panel" id="panelEdit" *ngIf="edit.enabled">

  <!-- ================= HEADER ================= -->
 <!-- ================= HEADER (ALWAYS VISIBLE) ================= -->
<!-- ================= HEADER (ALWAYS VISIBLE, STATIC TITLE) ================= -->
<div class="panel-header">
  <h4>Edit Tool</h4>
  <button class="panel-close" aria-label="Close" (click)="close()">×</button>
</div>



  <!-- ================= BODY ================= -->
  <div class="panel-body">

    <!-- ===== LAYER SELECTION ===== -->
    <div *ngIf="mode === 'table'" style="margin-bottom:8px;">
      <label>
        Select Assigned Layer
        <select
          [(ngModel)]="edit.editLayer"
          (change)="onLayerChange()"
        >
          <option [ngValue]="null">Select Layer</option>
          <option value="stations">Stations</option>
          <option value="landplan">Land Plan on Track</option>
        </select>
      </label>
    </div>

    <!-- ================= TABLE MODE ================= -->
    <ng-container *ngIf="edit.editLayer === 'stations' && mode === 'table'">

      <div class="toolbar">
        <button class="add-btn">Add New Record</button>
        <div class="spacer"></div>
        <label class="search">Search:</label>
        <input
          type="search"
          placeholder="code / state / district"
          [(ngModel)]="search"
          (ngModelChange)="onSearchChange()"
        />
      </div>

      <div class="card">
        <div class="table-scroll">
          <table class="tbl">
            <thead>
              <tr>
                <th>Station Code</th>
                <th>Dist (km)</th>
                <th>Dist (m)</th>
                <th>State</th>
                <th>District</th>
                <th>Actions</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngIf="loading">
                <td colspan="6" class="empty">Loading...</td>
              </tr>

              <tr *ngIf="!loading && rows.length === 0">
                <td colspan="6" class="empty">No records</td>
              </tr>

              <tr *ngFor="let r of rows">
                <td>{{ r.sttncode }}</td>
                <td>{{ r.distkm }}</td>
                <td>{{ r.distm }}</td>
                <td>{{ r.state }}</td>
                <td>{{ r.district }}</td>
                <td>
                  <button class="action-btn" (click)="editRow(r)">Edit</button>
                  <button class="action-btn" (click)="deleteRow(r)" [disabled]="deleting">Delete</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="pager">
          <div class="spacer"></div>
          <button class="btn" (click)="prevPage()" [disabled]="page === 1">
            Prev
          </button>
          <span>Page {{ page }} of {{ totalPages }}</span>
          <button
            class="btn"
            (click)="nextPage()"
            [disabled]="page * pageSize >= total"
          >
            Next
          </button>
        </div>
      </div>
    </ng-container>

    <!-- ================= EDIT MODE ================= -->
<!-- ================= EDIT MODE ================= -->
<div *ngIf="mode === 'edit'" class="edit-form">

  <div class="edit-top">
    <div>
      <h3 class="edit-title">Asset Details</h3>
      <!-- <div class="edit-subtitle">Selected Asset Details</div> -->
    </div>

    <button class="back-btn" (click)="cancelEdit()">← Back</button>
  </div>

  <div class="form-grid">

    <!-- Station Code + Validate -->
    <div class="field full">
      <label class="field-label">Station Code</label>
      <div class="field-inline">
        <input class="field-input" type="text" [value]="draft?.sttncode" />
        <button
          class="btn secondary"
          type="button"
          (click)="validateStationCode()"
          [disabled]="validating"
        >
          {{ validating ? 'Validating...' : 'Validate' }}
        </button>
      </div>
    </div>

    <div class="field">
      <label class="field-label">Station Name</label>
      <input class="field-input" type="text" [value]="draft?.sttnname" />
    </div>

    <div class="field">
      <label class="field-label">Station Type</label>
      <input class="field-input" type="text" [(ngModel)]="draft.stationtype" />
    </div>

    <div class="field">
      <label class="field-label">Dist (KM)</label>
      <input class="field-input" type="number" [(ngModel)]="draft.distkm" />
    </div>

    <div class="field">
      <label class="field-label">Dist (M)</label>
      <input class="field-input" type="number" [(ngModel)]="draft.distm" />
    </div>

    <div class="field">
      <label class="field-label">State</label>
      <input class="field-input" type="text" [(ngModel)]="draft.state" />
    </div>

    <div class="field">
      <label class="field-label">District</label>
      <input class="field-input" type="text" [(ngModel)]="draft.district" />
    </div>

    <div class="field">
      <label class="field-label">Category</label>
      <input class="field-input" type="text" [value]="draft?.category" />
    </div>

    <div class="field full">
      <label class="field-label">Constituency</label>
      <input class="field-input" type="text" [(ngModel)]="draft.constituency" />
    </div>
  </div>

  <div class="form-actions">
    <button class="btn ghost" disabled>Edit Geometry</button>
    <button class="btn ghost" disabled>Save Geometry</button>

    <button class="btn primary" (click)="send()" [disabled]="saving">
      {{ saving ? 'Saving...' : 'Send' }}
    </button>
  </div>

  <div class="error" *ngIf="error">
    {{ error }}
  </div>

  <p class="note">
    * For Station: Dist(KM)/Dist(M) optional • For Landplan: Polygon geometry required
  </p>

</div>


  </div>
</div>
